<!DOCTYPE html>
<meta charset="utf-8">

<head>

	<script type="text/javascript" src="../../src/d3.js"></script>

<style>

text {
  font: bold 48px monospace;
}

.update {

  fill: #333;

}

.new {

  fill: steelblue;
}


.remove {

  fill: red;
}

.bar {
  /*height: 50px;*/
}


</style>

</head>

<body>

  <p id="chart">
  
  <p id="menu"><b>Diffusion PQN 1999 - 2013</b><br>Year: <select></select>

<script type="text/javascript">

var margin = {top: 20, right: 40, bottom: 10, left: 40},
    width = 960,
    height = 250 - margin.top - margin.bottom;

var journaux,
    year;

var x = d3.scale.linear()
    .domain([100000,400000])
    .range([0, width/2]);

var color = d3.scale.category20();

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var menu = d3.select("#menu select")
    .on("change", updatedata);

var currentYear;

function updatedata() {
  currentYear = menu.property('value');

  var data = journaux.sort(function(a, b) { 
    return parseFloat(b[currentYear]) - parseFloat(a[currentYear])  
  });

  var bind = svg.selectAll('.journal').data(data, function(d) { return d.journal; });

  var bindEnter = bind.enter()
    .append('g')
    .attr('class', 'journal')
    .attr('transform', function(d, i) {
      return "translate(0, "+ (50 + i*60) +")";
    })
    ;

    bindEnter
      .append('text')
      .text(function(d) { return d.journal; });

    bindEnter
      .append('rect')
      .attr('class', 'bar')
      .attr('x', 300)
      .attr('y', -40)
      .attr('height', 50)
      .attr('width', function(d) { return x(parseFloat(d[currentYear])); })
      .attr('fill', function(d) { return color(d.journal); })
    ;

    bind
      .transition()
      .duration(1000)
      .attr('transform', function(d, i) {
        return "translate(0, "+ (50 + i*60) +")";
      })
    ;
    bind.selectAll('.bar')
      .transition()
      .duration(1000)
          .attr('width', function(d) { return x(parseFloat(d[currentYear])); })
      ;

}

// Question 1 : créer la visualisation PQN française

year = d3.range(1999, 2014);

d3.select('#menu select').selectAll('option')
  .data(year)
  .enter()
  .append('option')
  .attr('value', String)
  .text(String);

d3.csv('data/data-journaux.csv', function(data){

  journaux = data;

  updatedata();

});


</script>

</body>